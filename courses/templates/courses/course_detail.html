{% extends "base.html" %}
{% block content %}
<div class="container py-4">
    <div class="p-5 text-white bg-dark rounded shadow mb-4" style="background: linear-gradient(90deg, #1e3c72 0%, #2a5298 100%);">
        <h1 class="display-5 fw-bold">{{ course.code }} - {{ course.title }}</h1>
        <p class="lead"><i class="bi bi-person-circle"></i> {{ course.instructor.get_full_name|default:course.instructor.username }}</p>
        <span class="badge bg-success">ECTS: {{ course.ects_credit }}</span>
    </div>

    <ul class="nav nav-tabs mb-4" id="courseTabs">
        <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#content">Content</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#grades">Grades</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#los">Learning Outcomes</button></li>
    </ul>

    <div class="tab-content">
        <div class="tab-pane fade show active" id="content">
            {% for section in course.sections.all %}
                <div class="card mb-3 shadow-sm">
                    <div class="card-header fw-bold bg-light">{{ section.title }}</div>
                    <div class="card-body">
                        {% for material in section.materials.all %}
                            <a href="{{ material.link }}" class="d-block text-decoration-none mb-1">
                                <i class="bi bi-file-earmark-arrow-down me-2"></i>{{ material.title }}
                            </a>
                        {% empty %}<p class="text-muted small">No materials here.</p>{% endfor %}
                    </div>
                </div>
            {% empty %}<p>No content sections defined.</p>{% endfor %}
        </div>
        
        <div class="tab-pane fade" id="grades">
            <table class="table table-hover shadow-sm rounded overflow-hidden">
                <thead class="table-dark"><tr><th>Student</th><th>Assessment</th><th>Score</th></tr></thead>
                <tbody>
                    {% for g in student_grades %}
                    <tr><td>{{ g.student.username }}</td><td>{{ g.assessment.get_type_display }}</td><td class="fw-bold">{{ g.score_percentage }}%</td></tr>
                    {% empty %}<tr><td colspan="3" class="text-center py-4">No grades recorded yet.</td></tr>{% endfor %}
                </tbody>
            </table>
        </div>

        <div class="tab-pane fade" id="los">
            <ul class="list-group shadow-sm">
                {% for lo in learning_outcomes %}
                <li class="list-group-item"><strong>{{ lo.code }}:</strong> {{ lo.title }}<br><small class="text-muted">{{ lo.description }}</small></li>
                {% empty %}<li class="list-group-item">No LOs defined.</li>{% endfor %}
            </ul>
        </div>
    </div>
</div>
{% endblock %}